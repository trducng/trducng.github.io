<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="800" height="400" fill="#fafafa"/>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">Adversarial Embedding Perturbation Setup</text>

  <!-- Input tokens -->
  <text x="50" y="80" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#555">Input Tokens:</text>

  <!-- Token boxes -->
  <g transform="translate(50, 95)">
    <rect x="0" y="0" width="60" height="35" rx="4" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5"/>
    <text x="30" y="22" text-anchor="middle" font-family="monospace" font-size="11" fill="#1976d2">When</text>
  </g>
  <g transform="translate(70, 95)">
    <rect x="0" y="0" width="50" height="35" rx="4" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5"/>
    <text x="25" y="22" text-anchor="middle" font-family="monospace" font-size="11" fill="#1976d2">John</text>
  </g>
  <g transform="translate(130, 95)">
    <rect x="0" y="0" width="45" height="35" rx="4" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5"/>
    <text x="22" y="22" text-anchor="middle" font-family="monospace" font-size="11" fill="#1976d2">and</text>
  </g>
  <g transform="translate(185, 95)">
    <rect x="0" y="0" width="50" height="35" rx="4" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5"/>
    <text x="25" y="22" text-anchor="middle" font-family="monospace" font-size="11" fill="#1976d2">Mary</text>
  </g>
  <g transform="translate(245, 95)">
    <rect x="0" y="0" width="50" height="35" rx="4" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5"/>
    <text x="25" y="22" text-anchor="middle" font-family="monospace" font-size="11" fill="#1976d2">...</text>
  </g>
  <g transform="translate(305, 95)">
    <rect x="0" y="0" width="50" height="35" rx="4" fill="#ffcdd2" stroke="#c62828" stroke-width="2"/>
    <text x="25" y="22" text-anchor="middle" font-family="monospace" font-size="11" fill="#c62828">to</text>
  </g>

  <text x="380" y="117" font-family="Arial, sans-serif" font-size="11" fill="#c62828">(perturbed)</text>

  <!-- Arrow to embedding layer -->
  <line x1="200" y1="140" x2="200" y2="170" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Embedding Layer -->
  <rect x="50" y="175" width="300" height="45" rx="6" fill="#fff3e0" stroke="#e65100" stroke-width="1.5"/>
  <text x="200" y="202" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#e65100">Embedding Layer</text>

  <!-- Arrow to transformer -->
  <line x1="200" y1="225" x2="200" y2="255" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Transformer -->
  <rect x="50" y="260" width="300" height="45" rx="6" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1.5"/>
  <text x="200" y="287" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#2e7d32">Transformer Layers (x36)</text>

  <!-- Arrow to output -->
  <line x1="200" y1="310" x2="200" y2="340" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Output -->
  <rect x="100" y="345" width="200" height="40" rx="6" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="1.5"/>
  <text x="200" y="370" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#7b1fa2">Prediction: "Mary"</text>

  <!-- Right side: Results summary -->
  <rect x="430" y="70" width="350" height="290" rx="8" fill="#fff" stroke="#ccc" stroke-width="1"/>
  <text x="605" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Key Results</text>

  <!-- Result 1 -->
  <rect x="450" y="115" width="310" height="50" rx="4" fill="#ffebee"/>
  <text x="460" y="135" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#c62828">Last token only → "John"</text>
  <text x="460" y="155" font-family="Arial, sans-serif" font-size="11" fill="#555">88 iterations, cosine similarity drops to 0.35</text>

  <!-- Result 2 -->
  <rect x="450" y="175" width="310" height="50" rx="4" fill="#e8f5e9"/>
  <text x="460" y="195" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2e7d32">Last token only → wrong answer</text>
  <text x="460" y="215" font-family="Arial, sans-serif" font-size="11" fill="#555">Only 4 iterations needed</text>

  <!-- Result 3 -->
  <rect x="450" y="235" width="310" height="50" rx="4" fill="#e3f2fd"/>
  <text x="460" y="255" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1565c0">Random jittering</text>
  <text x="460" y="275" font-family="Arial, sans-serif" font-size="11" fill="#555">Model robust even at 200% noise</text>

  <!-- Result 4 -->
  <rect x="450" y="295" width="310" height="50" rx="4" fill="#fff3e0"/>
  <text x="460" y="315" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e65100">All tokens → "John"</text>
  <text x="460" y="335" font-family="Arial, sans-serif" font-size="11" fill="#555">Only 1 iteration (direct embedding update)</text>
</svg>